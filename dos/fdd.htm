<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html">
<META name="GENERATOR" content="IBM WebSphere Studio Homepage Builder Version 6.5.0.0 for Windows">
<META http-equiv="Content-Style-Type" content="text/css">
<TITLE>フロッピーディスクの構造(MS-DOS)</TITLE>
</HEAD>
<BODY bgcolor="#ffffff" text="#333333" link="#003399" vlink="#990033" alink="#339900" background="../w6b.gif">
<CENTER><IMG alt="直線上に配置" width="512" height="50" border="0" src="../bu06_l1.gif">
<H2>フロッピーディスクの構造 (MS-DOS)</H2>
<BR>
<TABLE width="512" border="0">
  <TBODY>
    <TR>
      <TD align="center"><B>独自研究の内容を多く含みます</B><BR>
      ※1.44MB FDについては無いものとします</TD>
    </TR>
  </TBODY>
</TABLE>
<IMG alt="直線上に配置" width="512" height="10" border="0" src="../pe03_l2.gif"><BR>
<TABLE width="512" border="0">
  <TBODY>
    <TR>
      <TD align="left">
      <PRE>★FDDの基礎
PC98のFDDは主に1MB、640KB、両用の3種類があります。
扱えるディスクの種別は、
1MB : 2HD (1.2MB)、8&quot;2D(1.2MB)、8&quot;1(S)(256KB)
640KB : 2DD/8(640KB)、2DD/9(720KB)
    * : 2D/8(320KB)、2D/9(360KB)、1D/8(160KB)、1D/9(180KB)
* : 640KB FDDから読み込み専用。書き込みは不可。

3.5&quot;/5&quot; 2HDと8&quot;2Dはディスクの仕様が異なりますが、
通常のDOSにおける使用範囲では意識する必要ありません。
[Tips]
8&quot;2Dは77トラックしかない。
3.5&quot;/5&quot;2HDは80トラックあるが、77トラックまでしか使わない。

VX以降の内臓FDDは640KB/1MB両用であることが多いです。
両用 = 内臓FDDと思ってもらってもかまいません。
（のっぺらボードを使って外部FDを内臓=両用とすることもできます）

尚、黎明期のDOSでは使用可能なFDDに制限があります。

・MS-DOS 1.25 PS98-111-SF
8&quot;ドライブ2基固定です。ドライブが1基しかなくても
Bドライブがあるものとして認識されます。
8&quot;2D (=1MB)と8&quot;1 (250KB)をサポートしています。

・MS-DOS 2.0 PS98-121-H4W
8&quot;ドライブ(=1MB)と5&quot;ドライブ(=640KB)に対応
まだ5&quot;2HD(1MB)は販売されていませんが、
8&quot;2Dとして5&quot;2HDが利用可能です。
8&quot;2D(=1MB)、8&quot;1(250KB)、5&quot;2DD(640KB)の読み書き、
640KB FDDからの5&quot;1D(160KB/180KB)、5&quot;2D(320KB/360KB)の読みに対応

1MB/640KB両用FDDは非対応です。
1.両用FDDから起動した場合、起動ディスクのフォーマットに固定
2.外部FDDから起動した場合、両用FDDは認識されない

・MS-DOS 2.0 PS98-122 以降
このバージョンから1MBと640KBという表記に変更。
両用FDDにも対応しました。
以降のバージョンは全て同じだと思います。

・MS-DOS 5.0A(-H)の後期版は1.44MB FDに対応しています

★320KB FD (MS-DOS 2.0以降)
320KB FDの利用は制限があります。
・640KB FDからのみ読み取り可能（←重要）
・読み取りのみでデータの書き込みはできない

両用FDDからも読み取りのみ可能です。

640KB経由の320KB FD書き込みに関してはこちらを参照

<a href="./640kb2d.htm">640KB FDDで1D/2Dを書く</a>

★320KB FDD (MS-DOS 1.25 - 2.0)
PC-9801/E/F/Mには320KB FDインタフェースという、
PC-80S31等と接続するポートがありました。
このFDDについてわかっている事を一番下にまとめました。

★FDフォーマット</PRE>
      <TABLE border="1" width="512">
        <TBODY>
          <TR>
            <TD align="center">1MB</TD>
            <TD valign="middle" align="center">250KB</TD>
            <TD valign="middle" align="center">1.25MB</TD>
            <TD valign="middle" align="center">1.21MB</TD>
            <TD valign="middle" align="center">1.44MB</TD>
          </TR>
          <TR>
            <TD align="center">名称</TD>
            <TD valign="middle" align="center">8&quot;1<BR>
            8&quot;1S</TD>
            <TD valign="middle" align="center">8&quot;2D<BR>
            5&quot;2HD<BR>
            3.5&quot;2HD</TD>
            <TD valign="middle" align="center">5&quot;2HC<BR>
            3.5&quot;2HC</TD>
            <TD valign="middle" align="center">3.5&quot;2HD</TD>
          </TR>
          <TR>
            <TD align="center">全容量<BR>
            (バイト)</TD>
            <TD valign="middle" align="center">256,256</TD>
            <TD valign="middle" align="center">1,261,568</TD>
            <TD valign="middle" align="center">1,213,952</TD>
            <TD valign="middle" align="center">1,474,560</TD>
          </TR>
          <TR>
            <TD align="center">実容量<BR>
            (バイト)</TD>
            <TD valign="middle" align="center">252,416</TD>
            <TD valign="middle" align="center">1,250,304</TD>
            <TD valign="middle" align="center"></TD>
            <TD valign="middle" align="center">1,457,664</TD>
          </TR>
          <TR>
            <TD align="center">面</TD>
            <TD valign="middle" align="center">片面</TD>
            <TD valign="middle" align="center">両面</TD>
            <TD valign="middle" align="center">両面</TD>
            <TD valign="middle" align="center">両面</TD>
          </TR>
          <TR>
            <TD align="center">シリンダ<BR>
            /面</TD>
            <TD valign="middle" align="center">77</TD>
            <TD valign="middle" align="center">77</TD>
            <TD valign="middle" align="center">80</TD>
            <TD valign="middle" align="center">80</TD>
          </TR>
          <TR>
            <TD align="center">トラック</TD>
            <TD valign="middle" align="center">77</TD>
            <TD valign="middle" align="center">154</TD>
            <TD valign="middle" align="center">160</TD>
            <TD valign="middle" align="center">160</TD>
          </TR>
          <TR>
            <TD align="center">セクタ/<BR>
            トラック</TD>
            <TD valign="middle" align="center">26</TD>
            <TD valign="middle" align="center">8</TD>
            <TD valign="middle" align="center">15</TD>
            <TD valign="middle" align="center">18</TD>
          </TR>
          <TR>
            <TD align="center">セクタ長<BR>
            (バイト)</TD>
            <TD valign="middle" align="center">128</TD>
            <TD valign="middle" align="center">1024</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">512</TD>
          </TR>
          <TR>
            <TD align="center">ルート<BR>
            ディレクトリ</TD>
            <TD valign="middle" align="center">68</TD>
            <TD valign="middle" align="center">192</TD>
            <TD valign="middle" align="center">224</TD>
            <TD valign="middle" align="center">224</TD>
          </TR>
          <TR>
            <TD align="center">セクタ/<BR>
            FAT</TD>
            <TD valign="middle" align="center">6</TD>
            <TD valign="middle" align="center">2</TD>
            <TD valign="middle" align="center">7</TD>
            <TD valign="middle" align="center">9</TD>
          </TR>
          <TR>
            <TD align="center">FAT ID</TD>
            <TD valign="middle" align="center">FE</TD>
            <TD valign="middle" align="center">FE</TD>
            <TD valign="middle" align="center">F9</TD>
            <TD valign="middle" align="center">F0 (?)</TD>
          </TR>
          <TR>
            <TD align="center">PDA</TD>
            <TD valign="middle" align="center">90</TD>
            <TD valign="middle" align="center">90</TD>
            <TD valign="middle" align="center">90</TD>
            <TD valign="middle" align="center">30</TD>
          </TR>
        </TBODY>
      </TABLE>※2HCはEPSON製MS-DOSのみ正式サポート。<BR>
      <BR>
      <TABLE border="1" width="512">
        <TBODY>
          <TR>
            <TD align="center">640KB</TD>
            <TD valign="middle" align="center">640KB</TD>
            <TD valign="middle" align="center">720KB</TD>
            <TD valign="middle" align="center">160KB</TD>
            <TD valign="middle" align="center">180KB</TD>
            <TD align="center">320KB</TD>
            <TD align="center">360KB</TD>
          </TR>
          <TR>
            <TD align="center">名称</TD>
            <TD valign="middle" align="center">2DD/8</TD>
            <TD valign="middle" align="center">2DD/9</TD>
            <TD valign="middle" align="center">1D/8</TD>
            <TD valign="middle" align="center">1D/9</TD>
            <TD align="center">2D/8</TD>
            <TD align="center">2D/9</TD>
          </TR>
          <TR>
            <TD align="center">全容量<BR>
            (バイト)</TD>
            <TD valign="middle" align="center">655,360</TD>
            <TD valign="middle" align="center">737,280</TD>
            <TD valign="middle" align="center">163,840</TD>
            <TD valign="middle" align="center">184,320</TD>
            <TD align="center">327,680</TD>
            <TD align="center">368,640</TD>
          </TR>
          <TR>
            <TD align="center">実容量<BR>
            (バイト)</TD>
            <TD valign="middle" align="center">649,216</TD>
            <TD valign="middle" align="center">730,112</TD>
            <TD valign="middle" align="center">160,256</TD>
            <TD valign="middle" align="center">179,712</TD>
            <TD align="center">322,560</TD>
            <TD align="center">362,496</TD>
          </TR>
          <TR>
            <TD align="center">面</TD>
            <TD valign="middle" align="center">両面</TD>
            <TD valign="middle" align="center">両面</TD>
            <TD valign="middle" align="center">片面</TD>
            <TD valign="middle" align="center">片面</TD>
            <TD valign="middle" align="center">両面</TD>
            <TD valign="middle" align="center">両面</TD>
          </TR>
          <TR>
            <TD align="center">シリンダ<BR>
            /面</TD>
            <TD valign="middle" align="center">80</TD>
            <TD valign="middle" align="center">80</TD>
            <TD valign="middle" align="center">40</TD>
            <TD valign="middle" align="center">40</TD>
            <TD align="center">40</TD>
            <TD align="center">40</TD>
          </TR>
          <TR>
            <TD align="center">トラック</TD>
            <TD valign="middle" align="center">160</TD>
            <TD valign="middle" align="center">160</TD>
            <TD valign="middle" align="center">40</TD>
            <TD valign="middle" align="center">40</TD>
            <TD align="center">80</TD>
            <TD align="center">80</TD>
          </TR>
          <TR>
            <TD align="center">セクタ/<BR>
            トラック</TD>
            <TD valign="middle" align="center">8</TD>
            <TD valign="middle" align="center">9</TD>
            <TD valign="middle" align="center">8</TD>
            <TD valign="middle" align="center">9</TD>
            <TD align="center">8</TD>
            <TD align="center">9</TD>
          </TR>
          <TR>
            <TD align="center">セクタ長<BR>
            (バイト)</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">512</TD>
          </TR>
          <TR>
            <TD align="center">ルート<BR>
            ディレクトリ</TD>
            <TD valign="middle" align="center">112</TD>
            <TD valign="middle" align="center">112</TD>
            <TD valign="middle" align="center">112</TD>
            <TD valign="middle" align="center">112</TD>
            <TD align="center">64</TD>
            <TD align="center">64</TD>
          </TR>
          <TR>
            <TD align="center">セクタ/<BR>
            FAT</TD>
            <TD valign="middle" align="center">2</TD>
            <TD valign="middle" align="center">3</TD>
            <TD valign="middle" align="center">1</TD>
            <TD valign="middle" align="center">2</TD>
            <TD align="center">1</TD>
            <TD align="center">2</TD>
          </TR>
          <TR>
            <TD align="center">FAT ID</TD>
            <TD valign="middle" align="center">FB</TD>
            <TD valign="middle" align="center">F9</TD>
            <TD valign="middle" align="center">FE</TD>
            <TD valign="middle" align="center">FC</TD>
            <TD align="center">FF</TD>
            <TD align="center">FD</TD>
          </TR>
          <TR>
            <TD align="center">PDA</TD>
            <TD valign="middle" align="center">70</TD>
            <TD valign="middle" align="center">70</TD>
            <TD valign="middle" align="center">70</TD>
            <TD valign="middle" align="center">70</TD>
            <TD align="center">70</TD>
            <TD align="center">70</TD>
          </TR>
        </TBODY>
      </TABLE>
      <BR>
      <BR>
      <TABLE border="1" width="512">
        <TBODY>
          <TR>
            <TD align="center">320KB<BR>
            (DOS 1.25)</TD>
            <TD valign="middle" align="center">160KB</TD>
            <TD align="center">320KB<BR>
            データ</TD>
            <TD align="center">320KB<BR>
            システム</TD>
          </TR>
          <TR>
            <TD align="center">名称</TD>
            <TD valign="middle" align="center">5&quot;1D</TD>
            <TD align="center">5&quot;2D</TD>
            <TD align="center">5&quot;2D</TD>
          </TR>
          <TR>
            <TD align="center">全容量(バイト)</TD>
            <TD valign="middle" align="center">163,840</TD>
            <TD align="center">327,680</TD>
            <TD align="center">327,680</TD>
          </TR>
          <TR>
            <TD align="center">実容量(バイト)</TD>
            <TD valign="middle" align="center">160,256</TD>
            <TD align="center">322,560</TD>
            <TD align="center">調査中</TD>
          </TR>
          <TR>
            <TD align="center">面</TD>
            <TD valign="middle" align="center">片面</TD>
            <TD valign="middle" align="center">両面</TD>
            <TD valign="middle" align="center">両面</TD>
          </TR>
          <TR>
            <TD align="center">シリンダ/面</TD>
            <TD valign="middle" align="center">40</TD>
            <TD align="center">40</TD>
            <TD align="center">40</TD>
          </TR>
          <TR>
            <TD align="center">トラック</TD>
            <TD valign="middle" align="center">40</TD>
            <TD align="center">80</TD>
            <TD align="center">80</TD>
          </TR>
          <TR>
            <TD align="center">セクタ/トラック</TD>
            <TD valign="middle" align="center">8</TD>
            <TD align="center">8</TD>
            <TD align="center">16</TD>
          </TR>
          <TR>
            <TD align="center">セクタ長(バイト)</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">512</TD>
            <TD valign="middle" align="center">256</TD>
          </TR>
        </TBODY>
      </TABLE>
      <PRE>※1.25は2.0と大きく仕様が異なります
・BPBがないためFAT IDが無い
・そもそも320KB FDDの制御はupd765でない

★FDの構造
2DD/8を例に説明します</PRE>
      <TABLE border="1" width="512">
        <TBODY>
          <TR>
            <TD>セクタ</TD>
            <TD>中身</TD>
          </TR>
          <TR>
            <TD>1</TD>
            <TD>IPL &amp; BPB</TD>
          </TR>
          <TR>
            <TD>2</TD>
            <TD rowspan="2">FATテーブル(1024バイト)</TD>
          </TR>
          <TR>
            <TD>3</TD>
          </TR>
          <TR>
            <TD>4</TD>
            <TD rowspan="2">予備FAT(1024バイト)</TD>
          </TR>
          <TR>
            <TD>5</TD>
          </TR>
          <TR>
            <TD>6</TD>
            <TD rowspan="7">ルートディレクトリエントリ<BR>
            1エントリ=32バイト<BR>
            1セクタ=16エントリ<BR>
            16エントリ×7セクタ=112エントリ</TD>
          </TR>
          <TR>
            <TD>7</TD>
          </TR>
          <TR>
            <TD>8</TD>
          </TR>
          <TR>
            <TD>9</TD>
          </TR>
          <TR>
            <TD>10</TD>
          </TR>
          <TR>
            <TD>11</TD>
          </TR>
          <TR>
            <TD>12</TD>
          </TR>
          <TR>
            <TD>13</TD>
            <TD>クラスタ002h</TD>
          </TR>
          <TR>
            <TD>14</TD>
            <TD>クラスタ003h</TD>
          </TR>
          <TR>
            <TD>15</TD>
            <TD>クラスタ004h</TD>
          </TR>
          <TR>
            <TD>16</TD>
            <TD>クラスタ005h</TD>
          </TR>
        </TBODY>
      </TABLE>
<PRE>
・IPL & BPB
実質ブートローダ(IPL)領域。
ディスクのフォーマット情報(BPB)も格納されている。

・FATテーブル
巨大なファイルは複数のクラスタ(セクタ)に跨って保存される。
その時、どこのクラスタに保存したかを記述する場所がFAT。
該当のクラスタ番号に対して次に参照すべき
クラスタ番号（または終端）が格納されている。
また、不良セクタや空きクラスタといった情報も格納されている。

非常に重要な領域なので、同じ内容の予備FATが後に続く。

・ルートディレクトリエントリ
ルートディレクトリのファイル情報が格納された領域。
ファイルの名前、サイズ、更新日時、
先頭クラスタ番号といったデータが格納されている。
領域が固定されているため、エントリ数に制限がある。

・クラスタ
データ領域。サブディレクトリエントリも含みます。
クラスタ000hと001hはFAT12の仕様上、無い事になっているため
クラスタ002hが先頭です。

★IPL &amp; BPB
場所:セクタ0

2.0以降ではBPBと呼ばれるFDの仕様を収めたブロックがあります。
PC98ではファイル操作時、BPBの情報を参照しません。
※2DDのIPLではFATIDで8セクタか9セクタかを判別しています。

※加筆予定。工事中

★FAT
IPLの次はFATテーブルがあります。
各セクタの使用状況が12bitで収められています。
FATが12bitだから、FAT12です。
基本的には次のセクタ番号です。
以下は特別な意味をもった値です。
・空き状態である (000h)
・終端セクタである (FFFh)
・不良セクタである(FF7h)
・予約済みである (FFBh, FFEhなど)

・リトルエンディアンの読み方
1セクタにつき12bit = 1.5バイトの情報のため、
読み取る際は2セクタ毎、3バイト毎に読みます。
桁毎にA2 A1 A0と振って、以下のような状況を仮定します。

クラスタA: A2 A1 A0 h
クラスタB: B2 B1 B0 h

この時、FATテーブルでは次のように格納されています。
[A1 A0] [B0 A2] [B2 B1]

以下は2DD/8の例です。
FATはIPLの次、セクタ1にあります。


     00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
0200 FB FF FF 03 40 00 05 60 00 07 80 00 09 A0 00 0B
0210 C0 00 0D E0 00 0F 00 01 11 20 01 13 40 01 15 60

この中から、FATセクタ010h, 011hを見てみます。

     08 09 0A
0210 11 20 01

この時、FATの値は次のように読み取る事ができます。
いずれも、次のセクタ番号が格納されています。
クラスタ010h: 011h
クラスタ011h: 012h

クラスタ000hと001hは予約済という仕様になっており、
領域がそもそも存在しません。

クラスタ002hの位置はフォーマット毎に異なります。
2DD/8であれば、セクタ12がクラスタ002hです。

次のセクタにも同じ内容のFATが予備で記録されています。

★ディレクトリエントリ
1エントリ32バイトで次の内容が記述されています。
オフセット
+00h - +0Ah : ファイル名(8文字+拡張子3文字) or 名前
+0Bh        : 属性
              0x01 : 読み取り専用 +R
              0x02 : 隠しファイル +H
              0x04 : システムファイル +S
              0x08 : ボリュームラベル
              0x10 : ディレクトリ
              0x20 : アーカイブ +A
+16h - +17h : 最終更新時刻
+18h - +19h : 最終更新日付
+1Ah - +1Bh : 先頭クラスタ番号
              0バイトのファイルとラベルは"0"
+1Ch - +1Fh : ファイルサイズ
              ディレクトリとラベルは0

・ファイル (+RHSA)
49 4F 20 20 20 20 20 20 53 59 53 27 00 00 00 00 IO      SYS'....
00 00 00 00 00 00 5B 7E 31 07 02 00 00 A0 00 00 ......[~1.......

・ボリュームラベル
50 52 4F 47 52 41 4D 20 20 20 20 28 00 00 00 00 PROGRAM    (....
00 00 00 00 00 00 BB 60 2E 11 00 00 00 00 00 00 ......ｻ`........

・サブディレクトリ
49 4E 43 4C 55 44 45 20 20 20 20 10 00 00 00 00 INCLUDE    .....
00 00 00 00 00 00 40 09 2E 11 30 02 00 00 00 00 ......@...0.....

ルートディレクトリエントリとサブディレクトリエントリは
少し内部の仕様が違います。
サブディレクトリエントリはデータとして考えるべきです。

★ルートディレクトリエントリ固有の仕様
・ボリュームラベルはルートディレクトリを1エントリ消費する
・領域固定のため、エントリ数に制限がある
・そのかわりいくらエントリを増やしてもクラスタを消費しない

★サブディレクトリエントリ固有の仕様
・サブディレクトリ作成時に「./」と「../」で2エントリ消費する
・1クラスタ内に収まらないと空きクラスタを消費する
(2DD/8なら16エントリ、2HDなら32エントリ毎に1クラスタ消費)
・そのかわりクラスタチェインによりエントリ数に制限が無い

★FDの構造
2D/8 システムディスク

・トラック0サイド0</PRE>
      <TABLE border="1" width="512">
        <TBODY>
          <TR>
            <TD>セクタ</TD>
            <TD>中身</TD>
          </TR>
          <TR>
            <TD>1</TD>
            <TD rowspan="2">IPL &amp; BPB</TD>
          </TR>
          <TR>
            <TD>2</TD>
          </TR>
          <TR>
            <TD>3</TD>
            <TD rowspan="2">FATテーブル(512バイト)</TD>
          </TR>
          <TR>
            <TD>4</TD>
          </TR>
          <TR>
            <TD>5</TD>
            <TD rowspan="2">予備FAT(512バイト)</TD>
          </TR>
          <TR>
            <TD>6</TD>
          </TR>
          <TR>
            <TD>7</TD>
            <TD rowspan="10">ルートディレクトリエントリ<BR>
            1エントリ=32バイト<BR>
            1セクタ=8エントリ<BR>
            8エントリ×14セクタ=112エントリ</TD>
          </TR>
          <TR>
            <TD>8</TD>
          </TR>
          <TR>
            <TD>9</TD>
          </TR>
          <TR>
            <TD>10</TD>
          </TR>
          <TR>
            <TD>11</TD>
          </TR>
          <TR>
            <TD>12</TD>
          </TR>
          <TR>
            <TD>13</TD>
          </TR>
          <TR>
            <TD>14</TD>
          </TR>
          <TR>
            <TD>15</TD>
          </TR>
          <TR>
            <TD>16</TD>
          </TR>
        </TBODY>
      </TABLE>
<PRE>
・トラック0サイド1
</PRE>
      <TABLE border="1" width="512">
        <TBODY>
          <TR>
            <TD>セクタ</TD>
            <TD>中身</TD>
          </TR>
          <TR>
            <TD>1</TD>
            <TD rowspan="4">ルートディレクトリエントリ<BR>
            1エントリ=32バイト<BR>
            1セクタ=8エントリ<BR>
            8エントリ×14セクタ=112エントリ</TD>
          </TR>
          <TR>
            <TD>2</TD>
          </TR>
          <TR>
            <TD>3</TD>
          </TR>
          <TR>
            <TD>4</TD>
          </TR>
          <TR>
            <TD>5</TD>
            <TD>クラスタ002h</TD>
          </TR>
          <TR>
            <TD>6</TD>
            <TD>クラスタ003h</TD>
          </TR>
        </TBODY>
      </TABLE>
<PRE>
★MS-DOS 1.25 (PS98-111)での320KB FDDについて
・MS-DOS 1.25の5&quot;版、PS98-111-H2Wは
　確定で320KB FDDから起動した
　（当時は640KBがないので5&quot; = 320KB）

・PS98-111-H2Wは256バイトセクタ

・PS98-111-SFのIO.SYSは1MB FDのDS0決め打ちで
　COMMAND.COMを探しにいくため、PS98-111-H2Wを
　練成する試みは失敗している

PS98-111-SFは8&quot;2D×2の決め打ち認識であり、
1MB FDDを4台使うことはできませんし、
320KB FDDについても認識しておらず使用できません。

FORMAT.COMには2D用IPLがあるため錬成は容易に見えますが、
PS98-111-H2WのIO.SYSが必要と思われます。

尚、PS98-111-H2W, -HSF, -SF でIO.SYSが異なるという事が
PC-PR101F2のマニュアルに書いてありました。

ゆえに、1MB -> 320KB への移植はできないものと考えています。

★MS-DOS 2.0 (PS98-122)以降での320KB FDDについて

みなさんご存知(?)の通り、MS-DOSは320KB FDDを認識しません。
そもそもMS-DOSのマニュアルに320KB FDDサポートの記述がありません。
（1MB FDD/640KB FDD/固定ディスクの3種類）

PS98-122のIPLを書き換えて320KB FDDから起動を試みたところ、
8&quot;2D版MS-DOS 1.25と同じく、1MB FDD or 640KB FDDのディスクへ
COMMAND.COMを探しに行ってしまいます。

また、640KB FDDからシステムディスク形式の2Dフォーマットは
利用できない事も確認しました。
※MS-DOS 2.0のマニュアルには以下のことが書かれている
　　「PS98-111-H2Wシステムにてフォーマットされた
　　システムディスクの形式のディスクはMS-DOS 2.0では
　　使用できません」

尚、外部ドライバで320KB FDDを認識・使用することは可能です。

★MS-DOS 2.0 (PS98-121)での320KB FDDについて

基本、上に同じですが、PS98-121-H2Wとして
320KB FDDから起動できるものが販売されていました。

ただ手持ちのPS98-121-H4Wでは320KB FDDを認識できず、
IPLを書き換えても1MB or 640KB FDDを探しに行ってしまいます。

そのためPS98-121-H2Wは特別なIO.SYSを持っていて、
そのバージョンでは320KB FDDが認識できたものと推測します。

★IPLの書き換えについて

システムディスク形式な320KB 2D用のIPLのつくりかた

合言葉は以下5つのパラメータ

・0100: BX FAT
・0105: DX IO.SYSの開始場所
・0007: DX FAT
・0C00: BX 最初のサイドで読む量
・1000: BX 1サイドあたりの容量

;とあるバージョンのIPL
BB0001         MOV	BX,0100 	;読み込むﾊﾞｲﾄ(256ﾊﾞｲﾄ)
C70602020501   MOV	Word Ptr [0202],0105 
BA0600         MOV	DX,0007 	;ﾍｯﾄﾞ No.0 ｾｸﾀ  No.7
C7060402000C   MOV	Word Ptr [0204],0C00 
C70606020010   MOV	Word Ptr [0206],1000 
B501           MOV	CH,01 		;ｾｸﾀ長N(256ﾊﾞｲﾄ)

;別のとあるバージョンのIPL
BB0001         MOV	BX,0100         ;読み込むﾊﾞｲﾄ(256ﾊﾞｲﾄ)
C70604020501   MOV	Word Ptr [0204],0105 ;サイド1セクタ5
C70606020700   MOV	Word Ptr [0206],0007 ;サイド0セクタ7
C7060802000C   MOV	Word Ptr [0208],0C00 ;256×12=3072ﾊﾞｲﾄ
C7060A020010   MOV	Word Ptr [020A],1000 ;256×16=4096ﾊﾞｲﾄ

バージョン毎にIPLが違うので↑を参考に変えてみてください。

★320KB FDD用MS-DOS起動ディスクは作れるのか？

【結論】
320KB 2D版MS-DOS以外はそもそも320KB FDD未対応で、
IPLを書き換えても無駄。

起動ディスクを作るには320KB 2D版MS-DOSが必要と思われる。

【蛇足】
推測ですが、IO.SYSで320KB FDDを認識させることができれば、
320KBな起動ディスクが作れると思います。

ただそんな技術力はない^^;

</PRE>
      </TD>
    </TR>
    <TR>
      <TD></TD>
    </TR>
  </TBODY>
</TABLE>
<IMG alt="直線上に配置" width="512" height="10" border="0" src="../pe03_l2.gif"><BR>
<BR>
<A href="index.htm"><IMG alt="トップ アイコン" width="64" height="64" align="middle" border="0" src="../st05_tp.gif"></A></CENTER>
</BODY>
</HTML>